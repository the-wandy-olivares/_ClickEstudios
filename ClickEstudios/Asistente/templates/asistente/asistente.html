{% extends "base/base.html" %}
{% block content %}
{% load humanize %}
      <style>
            .nav .asistente {
                  color: #ffc107;
                  font-weight: bolder;
                  transform: scale(1.1);
            }
            .nav .asistente svg {
                  color: #ffc107 !important;
            }
            .nav .asistente span {
                  color: #ffc107;
            }
            .btn-atras {
                  display: none;
            }
            .asistente-input {
                  display: none;
            }
            #asistente-input-0 {
            }
            #asistente-input-0:focus {
                  /* background-color: #ffc107 !important; */
                  /* color: black !important; */
            }
            .asistent-response {
                  color: #fefefed3;
            }
            .asistent-response span{
                  width: 100% !important;

                  padding: 10px;
            }
            .asistent-response h4{
                  color: #ffc107 !important;
                  font-weight: bolder;
                  width: max-content;
                  margin-top: 1rem;
                  background-color: #191919;
                  border-radius: 2rem;
                  padding: 0.2rem 1rem;

            }
            .asistent-response strong {
                  color: #ffffff !important;
                  width: 100%;
            }
            .asistent-response ul {
                  background-color: #252525;
                  width: 100%;
                  max-height: 10rem;
                  overflow: auto;
                  border-radius: 1.5rem;
                  margin-bottom: 0.4rem;
                  padding: 10px;

            }
            .asistent-response li {
                  padding: 0px;
                  margin: 0.4rem;

            }
      </style>
      <section class="w-100 d-flex flex-wrap justify-content-center align-content-end vh-100 ">
            <div style="max-width: 90%; height: 50vh;" class="w-100 text-white overflow-auto">
                  <h5 class="your-response">
                        Hi ðŸ‘‹, Â¡Buenos dias!
                  </h5>
                  <div class="asistent-response d-flex flex-wrap justify-content-start"> 
                        <span><h4>Holaa</h4></span> <p>Â¿En quÃ© puedo ayudarte?</p>
                        <strong>Sabe que puedes hacer</strong> 
                        <li>Un monoto de cosas</li>
                        <ul>
                              Si, muchas cosas
                        </ul>

                  </div>
            </div>
            <div class="w-100 d-flex flex-wrap justify-content-center align-content-center">
                  <input type="text" name="" id="asistente-input-0" class="w-100 p-3 blur-10 rounded-5  mt-5 mb-3 bg-white bg-opacity-10 border-0  text-white text-center"  value="Hi ðŸ‘‹, Â¡Buenos dias!" 
                  style="max-width: 19rem; outline: none;">
            </div>
      </section>
      <script>
            let asistente = document.getElementById('asistente-input-0');
            asistente.addEventListener('keyup', function(e) {
                  if (e.key === 'Enter') {
                        let content = asistente.value;
                        QuestionGemini(content);
                  }
            });

            function FormaTextIA(texto) {
                              const lineas = texto.split('\n');
                              let resultado = '';
                              let listaAbierta = false;

                              lineas.forEach(linea => {
                                    // Si es un encabezado (por ejemplo, "**TÃ­tulo:**")
                              if (linea.startsWith('**') && linea.endsWith(':**')) {
                                          resultado += ` <span> <h4>
                                                ${linea.replace(/\*\*(.*?)\*\*/g, '$1').replace(/:/g, '')}  
                                                </h4> </span> `;
                                    } 
                                    // Si es una lista (empieza con "* ")
                                    else if (linea.startsWith('* ')) {
                                          if (!listaAbierta) {
                                          resultado += '<ul>';
                                          listaAbierta = true;
                                          }
                                          resultado += `<li>${linea.substring(2).replace(/\*\*(.*?)\*\*/g, '<strong></strong>')}</li>`;
                                    } 
                                    // Si es texto normal
                                    else if (linea.trim() !== '') {
                                          if (listaAbierta) {
                                          resultado += '</ul>';
                                          listaAbierta = false;
                                          }
                                          resultado += `<p>${linea.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>`;
                                    }
                              });

                              // Cierra la lista si quedÃ³ abierta
                              if (listaAbierta) {
                                    resultado += '</ul>';
                              }

                              return resultado;

            }




            function QuestionGemini(question) {
                  $.ajax({
                        url: '{% url "asistente:question_gemini" %}',
                        data: {
                        question: question,},
                        success: function (data) {
                              document.querySelector('.your-response').innerHTML = data.your_question;
                              document.querySelector('.asistent-response').innerHTML = FormaTextIA(data.asistent_response) ;
                        },
                        error: function (data) {

                        }
                  }); 
            }
      </script>
{% endblock  %}